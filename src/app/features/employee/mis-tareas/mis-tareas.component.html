<!-- my-tasks.component.html -->
<div class="min-h-screen bg-[#fbfcfd] dark:bg-gray-900">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Header -->
    <div class="mb-10">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 class="text-2xl font-semibold text-slate-900 dark:text-gray-100 font_outfit">Mis Tareas</h1>
          <p class="text-sm text-slate-500 dark:text-gray-400 mt-1 font_outfit">Gestiona y organiza tus asignaciones pendientes</p>
        </div>
      
        <!-- Filtros y Ordenamiento -->
        <div class="flex items-center gap-2">
          <div class="hs-dropdown relative inline-flex">
            <button id="hs-dropdown-filter" type="button" 
                    class="hs-dropdown-toggle py-2.5 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-2xl  text-slate-700 shadow-2xs hover:bg-slate-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 font_outfit">
              <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
              </svg>
              Filtrar
            </button>
            
            <div class="hs-dropdown-menu transition-[opacity,margin] duration hs-dropdown-open:opacity-100 opacity-0 hidden min-w-60 z-10 mt-2 bg-white shadow-2xs rounded-3xl p-2 dark:bg-gray-800 dark:border dark:border-gray-700" 
                 aria-labelledby="hs-dropdown-filter">
              <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-xl text-sm text-slate-700 hover:bg-slate-50 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 cursor-pointer font_outfit transition-all duration-200" (click)="filtroEstado.set('todos')">
                Todas las tareas
              </a>
              <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-xl text-sm text-slate-700 hover:bg-slate-50 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 cursor-pointer font_outfit transition-all duration-200" (click)="filtroEstado.set('Pendiente')">
                Pendientes
              </a>
              <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-xl text-sm text-slate-700 hover:bg-slate-50 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 cursor-pointer font_outfit transition-all duration-200" (click)="filtroEstado.set('En Proceso')">
                En progreso
              </a>
              <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-xl text-sm text-slate-700 hover:bg-slate-50 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300 cursor-pointer font_outfit transition-all duration-200" (click)="filtroEstado.set('Finalizada')">
                Finalizadas
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Header -->

    <!-- Grid de Tareas -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">

      @for (tarea of tareasFiltradas(); track tarea.id) {
        <!-- NUEVO DISEÑO DE CARD - Estilo del dashboard -->
        <div class="group flex flex-col bg-white dark:bg-gray-800 rounded-[40px] shadow-2xs transition-all duration-300 hover:shadow-md hover:-translate-y-0.5 border border-slate-100 dark:border-gray-700/50 overflow-hidden font_outfit">

          <!-- Encabezado con color según prioridad -->
          <div class="p-5 pb-4 bg-gradient-to-br from-slate-50 via-white to-slate-50/30 dark:from-gray-700 dark:via-gray-800 dark:to-gray-700/30">
            <div class="flex justify-between items-start mb-3">
              <!-- Icono y título -->
              <div class="flex items-center gap-3 flex-1">
                <div class="flex-shrink-0 w-9 h-9 rounded-xl flex items-center justify-center bg-slate-100 text-slate-700 dark:bg-slate-800/40 dark:text-slate-400">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                </div>
                <h3 class="text-sm font-medium text-slate-900 dark:text-gray-100 line-clamp-2 flex-1">
                  {{ tarea.titulo }}
                </h3>
              </div>
            </div>
            
            <!-- Badge de prioridad -->
            <div class="inline-flex items-center gap-x-1.5 py-0.5 px-2.5 rounded-lg text-[10px] font-semibold uppercase tracking-wider"
                 [ngClass]="{
                   'bg-slate-100 text-slate-600 dark:bg-slate-800/30 dark:text-slate-400': tarea.prioridad === 'Baja',
                   'bg-slate-200 text-slate-700 dark:bg-slate-700/30 dark:text-slate-300': tarea.prioridad === 'Media',
                   'bg-slate-300 text-slate-800 dark:bg-slate-600/30 dark:text-slate-200': tarea.prioridad === 'Alta',
                   'bg-slate-900 text-white dark:bg-slate-900 dark:text-slate-100': tarea.prioridad === 'Urgente'
                 }">
              <span class="inline-block w-1.5 h-1.5 rounded-full"
                    [ngClass]="{
                      'bg-slate-400': tarea.prioridad === 'Baja',
                      'bg-slate-500': tarea.prioridad === 'Media',
                      'bg-slate-700': tarea.prioridad === 'Alta',
                      'bg-white': tarea.prioridad === 'Urgente'
                    }"></span>
              Prioridad {{ tarea.prioridad }}
            </div>
          </div>
          
          <!-- Contenido principal -->
          <div class="p-5 pt-3 flex flex-col flex-grow border-t border-slate-100 dark:border-gray-700">
            <!-- Descripción -->
            <p class="text-xs text-slate-600 dark:text-gray-400 line-clamp-3 mb-3 flex-grow leading-relaxed">
              {{ tarea.descripcion }}
            </p>
            
            <!-- Información de estado y progreso -->
            <div class="space-y-3">
              <!-- Estado -->
              <div class="flex items-center justify-between">
                <span class="text-[10px] font-medium text-slate-500 dark:text-gray-400 uppercase tracking-wider">Estado</span>
                <span class="inline-flex items-center gap-x-1.5 py-0.5 px-2 rounded-lg text-[10px] font-semibold uppercase tracking-wider"
                      [ngClass]="{
                        'bg-slate-100 text-slate-700 dark:bg-slate-800/30 dark:text-slate-400': tarea.estado === 'Pendiente',
                        'bg-slate-200 text-slate-800 dark:bg-slate-700/30 dark:text-slate-300': tarea.estado === 'En Proceso',
                        'bg-slate-900 text-white dark:bg-slate-900 dark:text-slate-100': tarea.estado === 'Finalizada'
                      }">
                  {{ tarea.estado }}
                </span>
              </div>
              
              <!-- Barra de progreso -->
              <div>
                <div class="flex justify-between mb-1.5">
                  <span class="text-[10px] font-medium text-slate-500 dark:text-gray-400 uppercase tracking-wider">Progreso</span>
                  <span class="text-[11px] font-bold text-slate-900 dark:text-gray-200">{{ tarea.progreso }}%</span>
                </div>
                <div class="flex w-full h-1.5 bg-slate-100 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner">
                  <div class="flex flex-col justify-center rounded-full overflow-hidden transition-all duration-500" 
                       [style.width.%]="tarea.progreso"
                       [ngClass]="{
                         'bg-slate-400': tarea.estado === 'Pendiente',
                         'bg-slate-600': tarea.estado === 'En Proceso',
                         'bg-slate-900': tarea.estado === 'Finalizada'
                       }">
                  </div>
                </div>
              </div>
              
              <!-- Fecha de vencimiento -->
              <div class="flex items-center justify-between pt-2.5 border-t border-slate-100 dark:border-gray-700">
                <div class="flex items-center gap-1.5 text-[11px] text-slate-500 dark:text-gray-400 font-medium">
                  <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18M12 12.75h.008v.008H12v-.008Z" />
                  </svg>
                  @if (tarea.fechaDeVencimiento) {
                    <span>Vence: {{ tarea.fechaDeVencimiento.toDate() | date:'d MMM' }}</span>
                  } @else {
                    <span class="italic">Sin fecha</span>
                  }
                </div>
                
                <a [routerLink]="[tarea.id]" 
                   class="inline-flex items-center gap-x-1 py-1.5 px-2.5 rounded-xl text-[10px] font-semibold bg-slate-100 text-slate-700 hover:bg-slate-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 transition-colors uppercase tracking-wider">
                  Ver detalles
                  <svg class="shrink-0 size-3" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      } @empty {
        <!-- Empty State -->
        <div class="sm:col-span-2 lg:col-span-3">
          <div class="flex flex-col items-center justify-center text-center p-12 bg-white dark:bg-gray-800 border border-dashed border-slate-300 dark:border-gray-600 rounded-[40px] shadow-2xs">
            <div class="flex justify-center items-center size-20 bg-[#5956e9]/10 rounded-full mb-6">
              <svg class="size-8 text-[#5956e9] dark:text-[#6d71f9]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
              </svg>
            </div>
            <h2 class="text-2xl font-semibold text-slate-900 dark:text-gray-100 mb-2 font_outfit">¡Estás al día!</h2>
            <p class="text-slate-600 dark:text-gray-400 mb-6 font_outfit">No tienes tareas pendientes. ¡Excelente trabajo!</p>
          </div>
        </div>
      }
    </div>
    <!-- End Grid -->
  </div>
</div>