<!-- Formulario de Escuela -->
<div class="min-h-screen bg-[#fcfdfe] dark:bg-[#1A1A1E] p-6 font_outfit">
    <div class="mx-auto px-1 py-10 max-w-6xl">

        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-2xl font-semibold text-[#2d2c63] dark:text-[#E4E4E7] mb-2">
                {{ isEditMode ? 'Editar Escuela' : 'Nueva Escuela' }}
            </h1>
            <p class="text-sm text-[#9291aa] dark:text-slate-400">
                {{ isEditMode ? 'Modifica los detalles de la escuela según sea necesario.' : 'Completa la información para registrar una nueva escuela.' }}
            </p>
        </div>

        <form [formGroup]="escuelaForm" (ngSubmit)="guardarCambios()" class="space-y-6">

            <!-- Card Información Básica -->
            <div class="bg-white dark:bg-[#2A2433] rounded-3xl shadow-2xs p-6">
                <h3 class="text-lg font-semibold text-[#2d2c63] dark:text-[#E4E4E7] mb-6 flex items-center gap-2">
                    <svg class="size-5 text-[#5956e9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Información Básica
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Columna Izquierda -->
                    <div class="space-y-6">
                        <!-- Nombre Completo -->
                        <div class="space-y-3">
                            <label for="nombreCompleto" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Nombre Completo *
                            </label>
                            <input id="nombreCompleto" formControlName="nombreCompleto" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (nombreCompleto?.touched && nombreCompleto?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (nombreCompleto?.errors?.['required']) {
                                <span>El nombre completo es obligatorio.</span>
                                }
                                @if (nombreCompleto?.errors?.['minlength']) {
                                <span>El nombre completo debe tener al menos 3 caracteres.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- CUE -->
                        <div class="space-y-3">
                            <label for="cue" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                CUE *
                            </label>
                            <input id="cue" formControlName="cue" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (cue?.touched && cue?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (cue?.errors?.['required']) {
                                <span>El CUE es obligatorio.</span>
                                }
                                @if (cue?.errors?.['pattern']) {
                                <span>El CUE debe tener el siguiente formato. Ej. 123456-78</span>
                                }
                                @if (escuelaForm.get('cue')?.hasError('cueDuplicado')) {
                                <span>Este CUE ya está registrado en otra escuela.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Nivel Educativo -->
                        <div class="space-y-3">
                            <label for="nivel" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Nivel Educativo *
                            </label>

                            <select id="nivel" name="nivel" formControlName="nivel"
                            
                                class="py-3 px-4 pe-9 block w-full border-gray-200 rounded-lg text-sm shadow-2xs text-[#707078] focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-[#443a52] dark:border-slate-700 dark:text-[#E4E4E7] dark:placeholder-neutral-500 dark:focus:ring-neutral-600">
                                <option value="" disabled selected>Seleccione un nivel...</option>
                                <option value="Primario">Primario</option>
                                <option value="Secundario">Secundario</option>
                                <option value="Terciario">Terciario</option>
                                <option value="Universitario">Universitario</option>
                            </select>

                            @if (nivel?.touched && nivel?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (nivel?.errors?.['required']) {
                                <span>El nivel educativo es obligatorio.</span>
                                }
                            </div>
                            }
                        </div>

                    </div>

                    <!-- Columna Derecha -->
                    <div class="space-y-6">
                        <!-- Nombre Corto -->
                        <div class="space-y-3">
                            <label for="nombreCorto" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Nombre Corto *
                            </label>
                            <input id="nombreCorto" formControlName="nombreCorto" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (nombreCorto?.touched && nombreCorto?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (nombreCorto?.errors?.['required']) {
                                <span>El nombre corto es obligatorio.</span>
                                }
                                @if (nombreCorto?.errors?.['minlength']) {
                                <span>El nombre corto debe tener al menos 3 caracteres.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Director -->
                        <div class="space-y-3">
                            <label for="director" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Director *
                            </label>
                            @if (directores().length > 0) {
                            <select id="director" formControlName="director" class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                                <option value="" disabled selected>Seleccione un director...</option>
                                @for (direct of directores(); track direct.uid) {
                                <option [value]="direct.uid">{{direct.nombre}} {{direct.apellido}}</option>
                                }
                            </select>
                            } @else {
                            <div class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] rounded-xl text-sm text-[#9291aa] dark:text-slate-400 shadow-2xs">
                                Cargando directores...
                            </div>
                            }
                            @if (director?.touched && director?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (director?.errors?.['required']) {
                                <span>El director es obligatorio.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Matrícula Total -->
                        <div class="space-y-3">
                            <label for="matriculaTotal" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Matrícula Total *
                            </label>
                            <input id="matriculaTotal" formControlName="matriculaTotal" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (matriculaTotal?.touched && matriculaTotal?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (matriculaTotal?.errors?.['required']) {
                                <span>La matrícula total es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Información de Contacto -->
            <div class="bg-white dark:bg-[#2A2433] rounded-3xl shadow-2xs p-6">
                <h3 class="text-lg font-semibold text-[#2d2c63] dark:text-[#E4E4E7] mb-6 flex items-center gap-2">
                    <svg class="size-5 text-[#5956e9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    Información de Contacto
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Columna Izquierda -->
                    <div class="space-y-6">
                        <!-- Dirección -->
                        <div class="space-y-3">
                            <label for="direccion" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Dirección *
                            </label>
                            <input id="direccion" formControlName="direccion" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (direccion?.touched && direccion?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (direccion?.errors?.['required']) {
                                <span>La dirección es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Teléfono -->
                        <div class="space-y-3">
                            <label for="telefono" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Teléfono *
                            </label>
                            <input id="telefono" formControlName="telefono" type="number"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (telefono?.touched && telefono?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (telefono?.errors?.['required']) {
                                <span>El teléfono es obligatorio.</span>
                                }
                            </div>
                            }
                        </div>
                    </div>

                    <!-- Columna Derecha -->
                    <div class="space-y-6">
                        <!-- Email -->
                        <div class="space-y-3">
                            <label for="email" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Email *
                            </label>
                            <input id="email" formControlName="email" type="email"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (email?.touched && email?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (email?.errors?.['required']) {
                                <span>El correo es obligatorio.</span>
                                }
                                @if (email?.errors?.['email']) {
                                <span>Debe ingresar un correo válido.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Sitio Web -->
                        <div class="space-y-3">
                            <label for="paginaWeb" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Sitio Web (Opcional)
                            </label>
                            <input id="paginaWeb" formControlName="paginaWeb" type="text"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Estadísticas -->
            <div class="bg-white dark:bg-[#2A2433] rounded-3xl shadow-2xs p-6">
                <h3 class="text-lg font-semibold text-[#2d2c63] dark:text-[#E4E4E7] mb-6 flex items-center gap-2">
                    <svg class="size-5 text-[#5956e9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Estadísticas
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Columna Izquierda -->
                    <div class="space-y-6">
                        <!-- Alumnos -->
                        <div class="space-y-3">
                            <label for="cantAlumnos" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Cantidad de Alumnos *
                            </label>
                            <input id="cantAlumnos" formControlName="cantAlumnos" type="number"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (cantAlumnos?.touched && cantAlumnos?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (cantAlumnos?.errors?.['required']) {
                                <span>La cantidad de alumnos es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Docentes -->
                        <div class="space-y-3">
                            <label for="cantDocentes" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Cantidad de Docentes *
                            </label>
                            <input id="cantDocentes" formControlName="cantDocentes" type="number"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (cantDocentes?.touched && cantDocentes?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (cantDocentes?.errors?.['required']) {
                                <span>La cantidad de docentes es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>
                    </div>

                    <!-- Columna Derecha -->
                    <div class="space-y-6">
                        <!-- Administrativos -->
                        <div class="space-y-3">
                            <label for="cantAdministrativos" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Cantidad de Administrativos *
                            </label>
                            <input id="cantAdministrativos" formControlName="cantAdministrativos" type="number"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (cantAdministrativos?.touched && cantAdministrativos?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (cantAdministrativos?.errors?.['required']) {
                                <span>La cantidad de administrativos es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>

                        <!-- Empleados -->
                        <div class="space-y-3">
                            <label for="cantEmpleados" class="block text-sm font-medium text-[#524380] dark:text-[#A78BFA]">
                                Total de Empleados *
                            </label>
                            <input id="cantEmpleados" formControlName="cantEmpleados" type="number"
                                class="py-3 px-4 block w-full bg-white dark:bg-[#443a52] dark:text-[#E4E4E7] dark:border-slate-700 rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs transition-all duration-200">
                            @if (cantEmpleados?.touched && cantEmpleados?.invalid) {
                            <div class="text-sm text-[#fb3640] mt-2">
                                @if (cantEmpleados?.errors?.['required']) {
                                <span>La cantidad de empleados es obligatoria.</span>
                                }
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Acciones -->
            <div class="bg-white dark:bg-[#2A2433] rounded-3xl shadow-2xs p-6">
                <div class="flex justify-end gap-3">
                    <a routerLink="/administracion/gestion-escuelas"
                        class="py-2.5 px-6 inline-flex items-center justify-center text-sm font-medium rounded-xl border border-transparent text-[#707078] hover:bg-[#fafbfe] dark:text-slate-300 dark:hover:bg-slate-700 transition-colors duration-200">
                        Cancelar
                    </a>
                    <button type="submit" [disabled]="escuelaForm.invalid || isSubmitting()"
                        class="py-2.5 px-6 inline-flex items-center justify-center gap-x-2 text-sm font-medium rounded-xl border border-transparent bg-[#5956e9] text-white hover:bg-[#4a47d8] disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 min-w-[140px]">
                        @if(isSubmitting()) {
                        <span
                            class="animate-spin inline-block size-4 border-2 border-current border-t-transparent rounded-full"></span>
                        <span>Guardando...</span>
                        } @else {
                        <span>{{ isEditMode ? 'Guardar Cambios' : 'Crear Escuela' }}</span>
                        }
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>