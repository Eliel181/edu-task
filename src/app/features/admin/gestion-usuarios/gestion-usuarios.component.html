<div class="max-w-8xl px-1 py-10 sm:px-2 lg:px-4 mx-auto font_outfit">
  <div class="bg-[#fcfdfe] rounded-3xl p-4 sm:p-4 shadow-[0_2px_6px_rgba(0,0,0,0.05)]">
    <!-- Header de la sección de usuarios -->
    <div class="mb-8 flex flex-col sm:flex-row justify-between sm:items-end gap-y-4">
      <div>
        <h2 class="text-xl font-semibold text-[#2d2c63]">Gestión de Usuarios</h2>
        <p class="text-sm text-[#9291aa] mt-2">
          Administra de forma eficiente los usuarios de tu plataforma.
        </p>
      </div>

      <!-- Barra de búsqueda mejorada -->
      <div class="relative sm:w-80">
        <input type="text" id="user-search-input" (input)="onBusquedaChange($event)"
          class="py-2.5 px-4 ps-11 block w-full bg-white rounded-xl text-sm text-[#707078] focus:border-[#5956e9] focus:ring-[#5956e9] shadow-2xs"
          placeholder="Buscar usuarios...">
        <div class="absolute inset-y-0 start-0 flex items-center pointer-events-none ps-4">
          <svg class="size-4 text-[#9291aa]" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
          </svg>
        </div>
      </div>
    </div>

    @if(isLoading()) {
    <div class="flex items-center justify-center h-80">
      <div class="relative">
        <div class="relative w-32 h-32">
          <div
            class="absolute w-full h-full rounded-full border-[3px] border-gray-100/10 border-r-[#5956e9] border-b-[#5956e9] animate-spin"
            style="animation-duration: 3s;"></div>
          <div
            class="absolute w-full h-full rounded-full border-[3px] border-gray-100/10 border-t-[#5956e9] animate-spin"
            style="animation-duration: 2s; animation-direction: reverse;"></div>
        </div>
        <div
          class="absolute inset-0 bg-gradient-to-tr from-[#5956e9]/10 via-transparent to-[#5956e9]/5 animate-pulse rounded-full blur-sm">
        </div>
      </div>
    </div>
    } @else {
    <!-- Tabla de Usuarios -->
    <div class="overflow-x-auto rounded-3xl shadow-[0_2px_6px_rgba(0,0,0,0.02)]">
      <table class="min-w-full divide-y divide-[#f0f1f8]">
        <thead class="bg-[#fafbfe]">
          <tr>
            <th scope="col" class="px-4 py-3 text-start text-xs font-semibold uppercase text-[#524380] tracking-wider">
              Usuario
            </th>
            <th scope="col"
              class="px-4 py-3 text-start text-xs font-semibold uppercase text-[#524380] tracking-wider hidden sm:table-cell">
              Contacto
            </th>
            <th scope="col" class="px-4 py-3 text-start text-xs font-semibold uppercase text-[#524380] tracking-wider">
              Rol
            </th>
            <th scope="col" class="px-2 py-3 text-center text-xs font-semibold uppercase text-[#524380] tracking-wider
         sm:static sticky right-0 bg-[#f9f9fe] z-30 w-16 min-w-[4rem]">
              Acciones
            </th>


          </tr>
        </thead>
        <tbody class="divide-y divide-[#f0f1f8]">
          @for (usuario of usuariosPaginados(); track usuario.uid) {
          <tr class="bg-white hover:bg-[#fcfdfe] transition-colors duration-200">
            <td class="px-4 py-3 whitespace-nowrap">
              <div class="flex items-center">

                <div class="shrink-0 size-10 rounded-xl overflow-hidden flex items-center justify-center shadow-2xs">

                  @if (usuario.perfil) {
                  <img class="size-full object-cover" [src]="usuario.perfil"
                    [alt]="usuario.nombre + ' ' + usuario.apellido">
                  } @else {
                  <div
                    class="size-10 rounded-xl flex items-center justify-center text-white font-semibold bg-[#5956e9]">
                    {{ (usuario?.nombre?.[0] ?? '') + (usuario?.apellido?.[0] ?? '') }}
                  </div>
                  }
                </div>
                <div class="ms-3">
                  <p class="text-sm font-medium text-[#4e3e76]">{{usuario.nombre}} {{usuario.apellido}}
                    @if(usuario.emailVerified){
                    <span class="ms-1 text-green-500" title="Email verificado">
                      <svg class="inline-block size-4" xmlns="http://www.w3.org/2000/svg" width="256" height="256"
                        viewBox="0 0 256 256">
                        <g fill="currentColor">
                          <path
                            d="M232 128c0 12.51-17.82 21.95-22.68 33.69c-4.68 11.32 1.42 30.65-7.78 39.85s-28.53 3.1-39.85 7.78C150 214.18 140.5 232 128 232s-22-17.82-33.69-22.68c-11.32-4.68-30.65 1.42-39.85-7.78s-3.1-28.53-7.78-39.85C41.82 150 24 140.5 24 128s17.82-22 22.68-33.69c4.68-11.31-1.42-30.65 7.78-39.85s28.54-3.1 39.85-7.78C106.05 41.82 115.5 24 128 24s22 17.82 33.69 22.68c11.32 4.68 30.65-1.42 39.85 7.78s3.1 28.53 7.78 39.85C214.18 106.05 232 115.5 232 128"
                            opacity="0.2" />
                          <path
                            d="M225.86 102.82c-3.77-3.94-7.67-8-9.14-11.57c-1.36-3.27-1.44-8.69-1.52-13.94c-.15-9.76-.31-20.82-8-28.51s-18.75-7.85-28.51-8c-5.25-.08-10.67-.16-13.94-1.52c-3.56-1.47-7.63-5.37-11.57-9.14C146.28 23.51 138.44 16 128 16s-18.27 7.51-25.18 14.14c-3.94 3.77-8 7.67-11.57 9.14c-3.25 1.36-8.69 1.44-13.94 1.52c-9.76.15-20.82.31-28.51 8s-7.8 18.75-8 28.51c-.08 5.25-.16 10.67-1.52 13.94c-1.47 3.56-5.37 7.63-9.14 11.57C23.51 109.72 16 117.56 16 128s7.51 18.27 14.14 25.18c3.77 3.94 7.67 8 9.14 11.57c1.36 3.27 1.44 8.69 1.52 13.94c.15 9.76.31 20.82 8 28.51s18.75 7.85 28.51 8c5.25.08 10.67.16 13.94 1.52c3.56 1.47 7.63 5.37 11.57 9.14c6.9 6.63 14.74 14.14 25.18 14.14s18.27-7.51 25.18-14.14c3.94-3.77 8-7.67 11.57-9.14c3.27-1.36 8.69-1.44 13.94-1.52c9.76-.15 20.82-.31 28.51-8s7.85-18.75 8-28.51c.08-5.25.16-10.67 1.52-13.94c1.47-3.56 5.37-7.63 9.14-11.57c6.63-6.9 14.14-14.74 14.14-25.18s-7.51-18.27-14.14-25.18m-11.55 39.29c-4.79 5-9.75 10.17-12.38 16.52c-2.52 6.1-2.63 13.07-2.73 19.82c-.1 7-.21 14.33-3.32 17.43s-10.39 3.22-17.43 3.32c-6.75.1-13.72.21-19.82 2.73c-6.35 2.63-11.52 7.59-16.52 12.38S132 224 128 224s-9.15-4.92-14.11-9.69s-10.17-9.75-16.52-12.38c-6.1-2.52-13.07-2.63-19.82-2.73c-7-.1-14.33-.21-17.43-3.32s-3.22-10.39-3.32-17.43c-.1-6.75-.21-13.72-2.73-19.82c-2.63-6.35-7.59-11.52-12.38-16.52S32 132 32 128s4.92-9.15 9.69-14.11s9.75-10.17 12.38-16.52c2.52-6.1 2.63-13.07 2.73-19.82c.1-7 .21-14.33 3.32-17.43s10.39-3.22 17.43-3.32c6.75-.1 13.72-.21 19.82-2.73c6.35-2.63 11.52-7.59 16.52-12.38S124 32 128 32s9.15 4.92 14.11 9.69s10.17 9.75 16.52 12.38c6.1 2.52 13.07 2.63 19.82 2.73c7 .1 14.33.21 17.43 3.32s3.22 10.39 3.32 17.43c.1 6.75.21 13.72 2.73 19.82c2.63 6.35 7.59 11.52 12.38 16.52S224 124 224 128s-4.92 9.15-9.69 14.11m-40.65-43.77a8 8 0 0 1 0 11.32l-56 56a8 8 0 0 1-11.32 0l-24-24a8 8 0 0 1 11.32-11.32L112 148.69l50.34-50.35a8 8 0 0 1 11.32 0" />
                        </g>
                      </svg>
                    </span>
                    } @else {
                    <span class="ms-1 text-red-400" title="Email no verificado">
                      <svg class="inline-block size-4" xmlns="http://www.w3.org/2000/svg" width="128" height="128"
                        viewBox="0 0 256 256">
                        <path fill="currentColor"
                          d="M225.86 102.82c-3.77-3.94-7.67-8-9.14-11.57c-1.36-3.27-1.44-8.69-1.52-13.94c-.15-9.76-.31-20.82-8-28.51s-18.75-7.85-28.51-8c-5.25-.08-10.67-.16-13.94-1.52c-3.56-1.47-7.63-5.37-11.57-9.14C146.28 23.51 138.44 16 128 16s-18.27 7.51-25.18 14.14c-3.94 3.77-8 7.67-11.57 9.14c-3.25 1.36-8.69 1.44-13.94 1.52c-9.76.15-20.82.31-28.51 8s-7.8 18.75-8 28.51c-.08 5.25-.16 10.67-1.52 13.94c-1.47 3.56-5.37 7.63-9.14 11.57C23.51 109.72 16 117.56 16 128s7.51 18.27 14.14 25.18c3.77 3.94 7.67 8 9.14 11.57c1.36 3.27 1.44 8.69 1.52 13.94c.15 9.76.31 20.82 8 28.51s18.75 7.85 28.51 8c5.25.08 10.67.16 13.94 1.52c3.56 1.47 7.63 5.37 11.57 9.14c6.9 6.63 14.74 14.14 25.18 14.14s18.27-7.51 25.18-14.14c3.94-3.77 8-7.67 11.57-9.14c3.27-1.36 8.69-1.44 13.94-1.52c9.76-.15 20.82-.31 28.51-8s7.85-18.75 8-28.51c.08-5.25.16-10.67 1.52-13.94c1.47-3.56 5.37-7.63 9.14-11.57c6.63-6.9 14.14-14.74 14.14-25.18s-7.51-18.27-14.14-25.18M120 80a8 8 0 0 1 16 0v56a8 8 0 0 1-16 0Zm8 104a12 12 0 1 1 12-12a12 12 0 0 1-12 12" />
                      </svg>
                    </span>
                    }
                  </p>
                  <p class="text-xs text-[#9291aa] truncate w-48 sm:w-auto">{{usuario.email}}

                  </p>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 whitespace-nowrap hidden sm:table-cell">
              <p class="text-sm text-[#707078]">{{usuario.telefono || 'N/A'}}</p>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
              @if (usuario.rol === 'Admin') {
              <span
                class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full text-xs font-medium bg-[#f0e7fa] text-[#8e44ad] shadow-sm">
                {{usuario.rol}}
              </span>
              } @else if (usuario.rol === 'RTE') {
              <span
                class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full text-xs font-medium bg-[#e7f0fa] text-[#3498db] shadow-sm">
                {{usuario.rol}}
              </span>
              } @else if (usuario.rol === 'Docente') {
              <span
                class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full text-xs font-medium bg-[#fae7e7] text-[#e74c3c] shadow-sm">
                {{usuario.rol}}
              </span>
              } @else {
              <span
                class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full text-xs font-medium bg-[#e7faed] text-[#2ecc71] shadow-sm">
                {{usuario.rol}}
              </span>
              }
            </td>
            <td
              class="px-2 py-3 whitespace-nowrap text-center sm:static sticky right-0 bg-white z-40 w-16 min-w-[4rem]">
              <div class="relative">
                <div class="hs-dropdown [--placement:bottom-right] inline-block">
                  <button type="button"
                    class="hs-dropdown-toggle p-1.5 inline-flex justify-center items-center rounded-full text-[#9291aa] hover:bg-[#f0f1f8] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-[#5956e9] transition-all duration-200 ease-out">
                    <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      viewBox="0 0 16 16">
                      <path
                        d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" />
                    </svg>
                  </button>

                  <!-- Menú desplegable -->
                  <div
                    class="hs-dropdown-menu transition-[opacity,margin] duration hs-dropdown-open:opacity-100 opacity-0 hidden min-w-40 z-[9999] bg-white shadow-[0_2px_6px_rgba(0,0,0,0.05)] rounded-2xl p-2 mt-2">
                    <div class="first:pt-0 last:pb-0">
                      <span class="block py-2 px-3 mb-2 text-xs font-medium uppercase text-[#9291aa]">Acciones</span>
                      <a class="flex items-center gap-x-3 py-2 px-3 rounded-lg text-sm text-[#796ffc] hover:bg-[#f9f9fe] transition-colors duration-200"
                        [routerLink]="['edicion-usuario', usuario.uid]">
                        <svg class="size-[18px]" xmlns="http://www.w3.org/2000/svg" width="128" height="128"
                          viewBox="0 0 24 24">
                          <g fill="currentColor">
                            <path
                              d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z" />
                            <path fill="currentColor"
                              d="M19 19a1 1 0 0 1 .117 1.993L19 21h-7a1 1 0 0 1-.117-1.993L12 19zm.631-14.632a2.5 2.5 0 0 1 0 3.536L8.735 18.8a1.5 1.5 0 0 1-.44.305l-3.804 1.729c-.842.383-1.708-.484-1.325-1.326l1.73-3.804a1.5 1.5 0 0 1 .304-.44L16.096 4.368a2.5 2.5 0 0 1 3.535 0M6 1a1 1 0 0 1 .946.677l.13.378a3 3 0 0 0 1.869 1.87l.378.129a1 1 0 0 1 0 1.892l-.378.13a3 3 0 0 0-1.87 1.869l-.129.378a1 1 0 0 1-1.892 0l-.13-.378a3 3 0 0 0-1.869-1.87l-.378-.129a1 1 0 0 1 0-1.892l.378-.13a3 3 0 0 0 1.87-1.869l.129-.378A1 1 0 0 1 6 1" />
                          </g>
                        </svg>
                        Editar
                      </a>
                    </div>
                    <div class="first:pt-0 last:pb-0">
                      <a class="flex items-center gap-x-3 py-2 px-3 rounded-lg text-sm text-[#e77833] hover:bg-[#fef9f9] transition-colors duration-200 cursor-pointer"
                        (click)="eliminarUsuario(usuario)">
                        <svg class="size-[18px]" xmlns="http://www.w3.org/2000/svg" width="128" height="128"
                          viewBox="0 0 48 48">
                          <path fill="currentColor" fill-rule="evenodd"
                            d="M3.842 27.88a7.92 7.92 0 0 1 0-8.76c3.23-4.872 7.107-8.528 9.356-10.443c1.452-1.237 3.258-1.857 5.087-1.931C20.838 6.642 25.196 6.5 30 6.5c3.443 0 6.764.073 9.364.152c3.76.115 6.808 3.052 6.956 6.846A258 258 0 0 1 46.5 23.5c0 4.158-.083 7.51-.18 10.002c-.148 3.794-3.196 6.73-6.956 6.846c-2.6.08-5.921.152-9.364.152c-4.804 0-9.162-.142-11.715-.246c-1.829-.074-3.635-.695-5.087-1.931c-2.249-1.916-6.125-5.57-9.356-10.443m33.54-7.851c.67-.724.86-1.742.26-2.526c-.251-.33-.58-.712-1.005-1.137A11.5 11.5 0 0 0 35.5 15.36c-.784-.599-1.802-.409-2.526.261a187 187 0 0 0-3.969 3.813a186 186 0 0 0-3.967-3.81c-.724-.671-1.742-.861-2.526-.262c-.33.252-.711.58-1.137 1.005c-.425.426-.753.808-1.005 1.137c-.6.784-.41 1.802.261 2.526a186 186 0 0 0 3.811 3.967c-1.868 1.9-3.073 3.17-3.817 3.973c-.67.724-.86 1.742-.26 2.526c.251.33.579.712 1.005 1.137s.807.754 1.136 1.005c.785.6 1.802.41 2.526-.26c.804-.744 2.074-1.95 3.973-3.818c1.9 1.87 3.171 3.075 3.975 3.819c.724.67 1.742.86 2.526.261c.33-.252.711-.58 1.137-1.005c.425-.426.753-.808 1.005-1.137c.6-.784.41-1.802-.261-2.526c-.744-.803-1.95-2.075-3.819-3.975a187 187 0 0 0 3.813-3.968Z"
                            clip-rule="evenodd" />
                        </svg>
                        Eliminar
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </td>

          </tr>
          } @empty {
          <tr>
            <td colspan="4" class="text-center p-10 text-[#9291aa]">
              No se encontraron usuarios con los filtros seleccionados.
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div class="mt-8 flex justify-center">
      <nav class="flex justify-center items-center gap-x-1" aria-label="Pagination">
        <button type="button"
          class="min-h-9.5 min-w-9.5 py-2 px-2.5 inline-flex justify-center items-center gap-x-2 text-sm rounded-lg text-[#707078] hover:bg-[#f0f1f8] focus:outline-none focus:bg-[#f0f1f8] disabled:opacity-50 disabled:pointer-events-none transition-all duration-200"
          aria-label="Previous" [disabled]="paginaActual() === 1" (click)="irAPagina(paginaActual() - 1)">
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m15 18-6-6 6-6"></path>
          </svg>
          <span class="sr-only">Previous</span>
        </button>

        <div class="flex items-center gap-x-1">
          @for (page of paginasDisponibles(); track page) {
          <button type="button" (click)="irAPagina(page)"
            [ngClass]="{'bg-[#5956e9] text-white shadow-sm': paginaActual() === page, 'text-[#707078] hover:bg-[#f0f1f8]': paginaActual() !== page}"
            class="min-h-9.5 min-w-9.5 flex justify-center items-center py-2 px-3 text-sm rounded-lg focus:outline-none disabled:opacity-50 disabled:pointer-events-none transition-all duration-200"
            [attr.aria-current]="paginaActual() === page ? 'page' : null">
            {{ page }}
          </button>
          }
        </div>

        <button type="button"
          class="min-h-9.5 min-w-9.5 py-2 px-2.5 inline-flex justify-center items-center gap-x-2 text-sm rounded-lg text-[#707078] hover:bg-[#f0f1f8] focus:outline-none focus:bg-[#f0f1f8] disabled:opacity-50 disabled:pointer-events-none transition-all duration-200"
          aria-label="Next" [disabled]="paginaActual() === totalPaginas()" (click)="irAPagina(paginaActual() + 1)">
          <span class="sr-only">Next</span>
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </button>
      </nav>
    </div>

    }
  </div>
</div>