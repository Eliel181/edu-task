<!-- Card Section -->
<div class="max-w-8xl px-4 py-10 sm:px-6 lg:px-8 mx-auto font_outfit dark:bg-[#1A1A1E]">
    <!-- Card -->
    @if (usuarioData; as user) {
    <div class="bg-[#fcfdfe] dark:bg-[#2A2433] rounded-3xl p-4 sm:p-7 shadow-[0_2px_6px_rgba(0,0,0,0.05)]">

        <div class="mb-8">
            <h2 class="text-xl font-semibold text-[#2d2c63] dark:text-[#E4E4E7]">
                Editar Usuario
            </h2>
            <p class="text-sm text-[#9291aa] dark:text-slate-400 mt-1">
                Gestiona el rol y permisos del usuario en el sistema.
            </p>
        </div>

        <form [formGroup]="profileForm" (ngSubmit)="actualizarUsuario()">

            <!-- Información del Usuario (Solo Lectura) -->
            <div class="grid grid-cols-12 gap-y-4 sm:gap-y-6 pb-8 border-b border-[#f0f1f8] dark:border-slate-700">
                <div class="col-span-12">
                    <div class="flex items-center gap-x-5">
                        <!-- Avatar -->
                        <div
                            class="relative size-20 rounded-full bg-[#f9f9fe] dark:bg-slate-700 flex items-center justify-center border-2 border-[#e2e3fa] dark:border-slate-600">
                            <img class="inline-block size-20 rounded-full object-cover"
                                [src]="imagenBase64Preview() || user.perfil || 'https://preline.co/assets/img/160x160/img1.jpg'"
                                alt="User Profile Picture">
                        </div>

                        <!-- Información Básica -->
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-[#2d2c63] dark:text-[#E4E4E7]">{{ user.nombre }} {{ user.apellido }}</h3>
                            <p class="text-sm text-[#9291aa] dark:text-slate-400">{{ user.email }}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span
                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-[#f0f1f8] text-[#524380] border border-[#e2e3fa] dark:bg-slate-700 dark:text-slate-300 dark:border-slate-600">
                                    {{ user.rol }}
                                </span>
                                <span class="text-xs text-[#9291aa] dark:text-slate-500">ID: {{ route.snapshot.paramMap.get('id') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalles de Información (Solo Lectura) -->
            <div class="grid sm:grid-cols-2 gap-4 sm:gap-6 py-6 border-b border-[#f0f1f8] dark:border-slate-700">
                <!-- Información Personal -->
                <div class="space-y-4">
                    <h4 class="text-sm font-semibold text-[#524380] dark:text-[#A78BFA] uppercase tracking-wide">Información Personal</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-[#9291aa] dark:text-slate-400 mb-1">Nombre Completo</label>
                            <div class="py-2 px-3 bg-[#f9f9fe] dark:bg-[#443a52] rounded-lg border border-[#e2e3fa] dark:border-slate-700">
                                <span class="text-sm text-[#2d2c63] dark:text-[#E4E4E7]">{{ user.nombre }} {{ user.apellido }}</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa] dark:text-slate-400 mb-1">Teléfono</label>
                            <div class="py-2 px-3 bg-[#f9f9fe] dark:bg-[#443a52] rounded-lg border border-[#e2e3fa] dark:border-slate-700">
                                <span class="text-sm text-[#2d2c63] dark:text-[#E4E4E7]">{{ user.telefono || 'No especificado' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de Cuenta -->
                <div class="space-y-4">
                    <h4 class="text-sm font-semibold text-[#524380] dark:text-[#A78BFA] uppercase tracking-wide">Información de Cuenta</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-[#9291aa] dark:text-slate-400 mb-1">Email</label>
                            <div class="py-2 px-3 bg-[#f9f9fe] dark:bg-[#443a52] rounded-lg border border-[#e2e3fa] dark:border-slate-700">
                                <span class="text-sm text-[#2d2c63] dark:text-[#E4E4E7]">{{ user.email }}</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs text-[#9291aa] dark:text-slate-400 mb-1">Estado de Verificación</label>
                            <div class="py-2 px-3 bg-[#f9f9fe] dark:bg-[#443a52] rounded-lg border border-[#e2e3fa] dark:border-slate-700">
                                <span class="text-sm flex items-center gap-1"
                                    [class.text-green-600]="user.emailVerified"
                                    [class.text-[#e77833]]="!user.emailVerified">
                                    <svg class="size-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    {{ user.emailVerified ? 'Email verificado' : 'Email pendiente de verificación' }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección Editable - Rol -->
            <div class="py-6">
                <div class="max-w-md">
                    <h4 class="text-sm font-semibold text-[#524380] dark:text-[#A78BFA] uppercase tracking-wide mb-4">Configuración de Rol
                    </h4>

                    <div class="space-y-3">
                        <div>
                            <label for="rol" class="block text-sm font-medium text-[#4e3e76] dark:text-[#A78BFA] mb-2">Asignar Rol</label>

                            <!-- Select -->
                            <select id="rol" name="rol" formControlName="rol"
                                class="py-2.5 px-4 block w-full border border-[#e2e3fa] rounded-xl shadow-sm focus:border-[#524380] focus:ring-2 focus:ring-[#524380]/20 transition-all duration-300 font_outfit bg-white dark:bg-[#443a52] dark:border-slate-700 dark:text-[#E4E4E7]">
                                <option value="Admin">Administrador</option>
                                <option value="Director">Director</option>
                                <option value="RTE">RTE</option>
                                <option value="Docente">Docente</option>
                                <option value="Empleado">Empleado</option>
                            </select>
                            <!-- End Select -->
                        </div>

                        <p class="text-xs text-[#9291aa] dark:text-slate-400">
                            El rol determina los permisos y acceso del usuario en el sistema.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Sección de Botones -->
            <div class="mt-8 pt-8 border-t border-[#f0f1f8] dark:border-slate-700">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <!-- Información de estado -->
                    <div class="text-sm text-[#9291aa] dark:text-slate-400 font_outfit">
                        @if (profileForm.dirty) {
                        <span class="inline-flex items-center gap-1 text-[#524380] dark:text-purple-300">
                            <svg class="size-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"
                                    clip-rule="evenodd" />
                            </svg>
                            Cambios pendientes en el rol
                        </span>
                        } @else {
                        <span>El rol está actualizado</span>
                        }
                    </div>

                    <!-- Contenedor de Botones -->
                    <div class="flex gap-3">
                        <!-- Botón Volver -->
                        <button routerLink="/administracion/gestion-usuarios" type="button" [disabled]="isSubmitting"
                            class="py-2 px-5 inline-flex items-center gap-x-2 text-sm font-medium rounded-xl bg-white text-[#8276a2] hover:bg-[#f9f9fe] hover:text-[#524380] transition-all duration-200 font_outfit disabled:opacity-40 disabled:pointer-events-none shadow-2xs dark:bg-slate-700 dark:text-slate-300 dark:hover:bg-slate-600">
                            Volver a Usuarios
                        </button>

                        <!-- Botón Guardar Cambios -->
                        <button type="submit" [disabled]="isSubmitting() || !profileForm.dirty"
                            class="py-2 px-5 inline-flex items-center justify-center gap-x-2 text-sm font-semibold rounded-xl bg-[#5956e9] text-white transform hover:scale-[1.02] active:scale-95 transition-all duration-200 font_outfit disabled:opacity-40 disabled:pointer-events-none shadow-2xs hover:shadow-md">

                            @if (isSubmitting()) {
                            <div class="animate-spin inline-block size-4 border-2 border-current border-t-transparent rounded-full"
                                role="status" aria-label="loading"></div>
                            <span>Actualizando...</span>
                            } @else {
                            <span>Actualizar Rol</span>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- End Card -->
    }
</div>